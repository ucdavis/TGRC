@model TGRC.Models.AccessionMapViewModel

<h2> Display Maps of Wild Species Collection Sites</h2>

<form method="post" asp-action="Maps">
<table>
    <tr>
        <th>Country</th>
        <th>Province</th>
        <th>Status</th>
    </tr>
    <tr>
        <td><select asp-for="CountrySelected" class="form-select form-select-sm">
                    <option value="[Any]">[Any]</option> 
                    <option value="Chile">Chile</option> 
                    <option value="Colombia">Colombia</option> 
                    <option value="Ecuador">Ecuador</option> 
                    <option value="Peru">Peru</option>   
            </select>
        </td>
        <td><select asp-for="ProvinceSelected" class="form-select form-select-sm" asp-items="@(new SelectList(Model.ProvinceList))"></select></td>
        <td><select asp-for="StatusSelected" class="form-select form-select-sm">
                <option value="[Any">[Any]</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
                <option value="Unavailable">Unavailable</option>
        </select></td>
    </tr>
</table>

<div class="container col-sm-12 row">
    <div class="col-sm-10">
        <div id="map" style="width: 900px; height: 800px;">
        </div>
    </div>
    <div class="col-sm-2">
        species lists
        <br>
        <input type="submit" value="Create Map & Spredsheet">
    </div>
</div>
</form>
@if(Model.accessions.Any())
{
<div class="col-sm-12 container">
    <table class="table datatable">
        <thead>
            <th>Accession</th>
            <th>Status</th>
            <th>Lat</th>
            <th>Long</th>
            <th>Source</th>
            <th>Elevation</th>
            <th>Source</th>
            <th>Taxon</th>
            <th>Taxonn</th>
            <th>Collection Site</th>
            <th>Site details</th>
            <th>Province/Department</th>
            <th>Country</th>
            <th>Coll. No.</th>
            <th>Coll. Date (mm/dd/yyyy)</th>
            <th>Pop. Size</th>
            <th>Sample Size</th>
            <th>Habitat</th>
            <th>Assoc. biota</th>
            <th>Coll. notes</th>
        </thead>    
        <tbody>
            @foreach (var acc in Model.accessions)
            {
                <tr>
                    <td>
                        <a asp-action="detail" asp-controller="Accession" asp-route-id="@acc.AccessionNum">@acc.AccessionNum</a><br>
                    </td>
                    <td>@acc.Status</td>
                    <td>@acc.LatDec</td>
                    <td>@acc.LonDec</td>
                    <td>@acc.LatSec</td>
                    <td>@acc.Elevation</td>
                    <td>@acc.ElevSource</td>
                    <td>@acc.Taxon</td>
                    <td>@acc.Taxon2</td>
                    <td>@acc.CollectionSite</td>
                    <td>@acc.SiteDetails</td>
                    <td>@acc.ProvinceOrDepartment</td>
                    <td>@acc.Country</td>
                    <td>@acc.CollectionNum</td>
                    <td>@acc.CollectionDateCombined</td>
                    <td>@acc.PopulationSize</td>
                    <td>@acc.SampleSize</td>
                    <td>@acc.Habitat</td>
                    <td>@acc.AssociatedBiota</td>
                    <td><div class="scrollableCell">@acc.CollectionNotes</div></td>
                </tr>                
            }
        </tbody>
    </table>
</div>
}


@section Scripts {

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4TCJI-Gh6lmCjfJ2FvHg2Z_VL9gJ5Jqc&callback=initMap" defer></script>
    <script src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js"></script>   
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.4/css/buttons.dataTables.min.css" />
    <script src="https://cdn.datatables.net/buttons/2.3.4/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.4/js/buttons.html5.min.js"></script>

    <script type="text/Javascript">       
        $( document ).ready(function() {
             $('.datatable').DataTable({
                dom: 'Bfrtip',
                buttons: [ 'csvHtml5'],
                "paging": false,
            });
           

            $("#CountrySelected").change(function() {
               var country = $("#CountrySelected").val();
               if(country != "[Any]") 
               {
                    $.ajax({  
                    type: "get",  
                    url: "/Accession/ProvinceListForCountry/" + country,  
                    //data: { stateId: $('#ddlState').val() },  
                    datatype: "json",  
                    traditional: true,  
                    success: function (data) {  
                        var provinces = "";  
                        for (var i = 0; i < data.length; i++)  
                        {  
                            provinces = provinces + '<option value=' + data[i] + '>' + data[i] + '</option>';  
                        }                      
                        $('#ProvinceSelected').html(provinces);  
                    }  
                    });  
               }
            }); 

                    
        });  
        let map;

        function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 0, lng: 180 },
            zoom: 10,
        });
        }

        window.initMap = initMap;  
    </script>
    
    
}